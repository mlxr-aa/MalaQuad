import{a as e,r as a,c as l,w as s,f as t,b as n,o as r,e as u,t as i,g as c,F as v,z as o,x as d,n as p,y,p as m,s as g,E as h,m as b,G as k,H as f}from"./vendor-DXzVRmrf.js";import{u as x,a as T,_ as I}from"./index-BAKp4GXE.js";const w={class:"reader-container"},C={key:0,class:"loading-container"},$={key:1,class:"error-container"},A={class:"error-content"},M={class:"error-message"},_={key:2,class:"empty-container"},H={key:0,class:"prelude-cover"},L={key:0,class:"prelude-page"},E={class:"cover-overlay"},U={class:"cover-content"},R={class:"cover-title"},V={key:0,class:"cover-author"},j={class:"chapter-list"},D={key:1,class:"cover-description"},P={class:"description-text"},z={key:1,class:"prelude-page"},B={class:"cover-overlay"},F={class:"cover-content"},G={class:"cover-title"},S={key:0,class:"prelude-content"},W=["innerHTML"],X={key:1,class:"user-identity"},Y={class:"identity-text"},q={key:1,class:"scene-content"},J={class:"scene-text-container"},K=["innerHTML"],N={key:2,class:"immersive-ui"},O={class:"top-title"},Q={class:"title-content"},Z={class:"main-title"},ee={class:"chapter-name"},ae={class:"bottom-progress"},le={class:"progress-bar"},se={class:"progress-text"},te={class:"settings-panel"},ne={key:0,class:"settings-content"},re={class:"setting-item"},ue={class:"setting-item"},ie={class:"setting-item"},ce={class:"opacity-value"},ve={class:"setting-item"},oe=I(e({__name:"Reader",setup(e){const f=b(),I=x(),oe=T(),de=a(!1),pe=a(null),ye=a(!1),me=a(!1),ge=a(!1),he=a(1),be=a("white"),ke=a(.8),fe=a(null),xe=a(0),Te=l(()=>oe.currentThemeData),Ie=l(()=>I.currentIndex),we=l(()=>I.maxUnlocked),Ce=l(()=>{var e;if(!Te.value)return"";if(Array.isArray(Te.value.scenes))return(null==(e=Te.value.scenes[Ie.value])?void 0:e.image)||"";{if(0===Ie.value)return Te.value.prelude.coverImage||"";const e=Ie.value-1;return Te.value.images[e]||""}}),$e=l(()=>{var e;if(!Te.value)return"";if(Array.isArray(Te.value.scenes))return(null==(e=Te.value.scenes[Ie.value])?void 0:e.content)||"";{if(0===Ie.value)return Te.value.prelude.title||"";const e=["scene1","scene2","scene3","epilogue"][Ie.value-1];return Te.value.scenes[e]||""}}),Ae=l(()=>Te.value?Array.isArray(Te.value.scenes)?Te.value.scenes.slice(1).map(e=>e.title):Te.value.chapterTitles&&Te.value.chapterTitles.length>0?Te.value.chapterTitles:["ç¬¬ä¸€å¹•","ç¬¬äºŒå¹•","ç¬¬ä¸‰å¹•","å°¾å£°"]:[]),Me=async()=>{pe.value=null,await Fe()},_e=async()=>{f.push("/")},He=()=>{I.setIndex(1)},Le=()=>{xe.value=1},Ee=()=>{xe.value=0},Ue=()=>{ye.value=!ye.value},Re=e=>e.replace(/\n/g,"<br>"),Ve=e=>{const a=e.currentTarget.getBoundingClientRect(),l=e.clientX-a.left,s=e.clientY-a.top,t=a.width,n=a.height;if(0!==Ie.value||0!==xe.value)return 0===Ie.value&&1===xe.value?l<.3*t?void Ee():l>.7*t?void He():l>.3*t&&l<.7*t&&s>.3*n&&s<.7*n?(me.value=!me.value,void(ge.value=!1)):void 0:l>.3*t&&l<.7*t&&s>.3*n&&s<.7*n?(me.value=!me.value,void(ge.value=!1)):void(l<.3*t?Ie.value>0&&I.prev():l>.7*t&&Ie.value<we.value&&I.next());l>.3*t&&l<.7*t&&s>.3*n&&s<.7*n&&Le()},je=()=>{ge.value=!ge.value},De=()=>{document.documentElement.style.setProperty("--font-scale",he.value.toString())},Pe=()=>{document.documentElement.style.setProperty("--text-color",be.value)},ze=()=>{},Be=e=>{var a;if(!Te.value)return"æœªçŸ¥ç« èŠ‚";if(Array.isArray(Te.value.scenes)){const a=Te.value.scenes[e];return a?a.title:"æœªçŸ¥ç« èŠ‚"}if(0===e)return"åºå¹•";if(4===e)return"å°¾å£°";{const l=e-1,s=null==(a=Te.value.chapterTitles)?void 0:a[l];return s?`ç¬¬${e}å¹•Â·${s}`:`ç¬¬${e}å¹•`}},Fe=async()=>{if(I.currentThemeId)try{de.value=!0,pe.value=null;await oe.loadTheme(I.currentThemeId)||(pe.value=oe.errorMessage||"åŠ è½½ä¸»é¢˜å¤±è´¥")}catch(e){pe.value=`åŠ è½½ä¸»é¢˜å¤±è´¥: ${e}`}finally{de.value=!1}else pe.value="æœªé€‰æ‹©ä¸»é¢˜"};return s(()=>I.currentThemeId,async e=>{var a;e&&e!==(null==(a=oe.currentThemeData)?void 0:a.id)&&await Fe()}),s(()=>oe.hasError,e=>{e&&(pe.value=oe.errorMessage)}),s(()=>Ie.value,async()=>{await k(),fe.value&&(fe.value.scrollTop=0)}),t(async()=>{await Fe()}),(e,a)=>{var l;return r(),n("div",w,[de.value?(r(),n("div",C,[...a[3]||(a[3]=[u("div",{class:"loading-content"},[u("div",{class:"loading-spinner"}),u("p",{class:"loading-text"},"åŠ è½½ä¸­...")],-1)])])):pe.value?(r(),n("div",$,[u("div",A,[a[4]||(a[4]=u("div",{class:"error-icon"},"âš ï¸",-1)),a[5]||(a[5]=u("h2",{class:"error-title"},"åŠ è½½å¤±è´¥",-1)),u("p",M,i(pe.value),1),u("button",{class:"btn btn-primary",onClick:Me},"é‡è¯•")])])):Te.value?(r(),n("div",{key:3,class:"reader-content",onClick:Ve},[0===Ie.value?(r(),n("div",H,[0===xe.value?(r(),n("div",L,[u("div",{class:"cover-background",style:d({backgroundImage:`url(${Te.value.prelude.coverImage})`})},[u("div",E,[u("div",U,[u("h1",R,i(Te.value.prelude.title),1),Te.value.prelude.author?(r(),n("div",V," ä½œè€…: "+i(Te.value.prelude.author),1)):c("",!0),u("div",j,[a[9]||(a[9]=u("div",{class:"chapter-item active"},"åºå¹•",-1)),(r(!0),n(v,null,o(Ae.value.slice(0,3),(e,a)=>(r(),n("div",{class:"chapter-item",key:a},i(`ç¬¬${a+1}å¹•${e?"Â·"+e:""}`),1))),128)),a[10]||(a[10]=u("div",{class:"chapter-item"},"å°¾å£°",-1))]),Te.value.prelude.subtitle?(r(),n("div",D,[a[11]||(a[11]=u("h3",{class:"description-title"},"ç®€ä»‹",-1)),u("p",P,i(Te.value.prelude.subtitle),1)])):c("",!0),u("button",{class:"enter-story-btn",onClick:Le}," å¼€å§‹é˜…è¯» ")])])],4)])):1===xe.value?(r(),n("div",z,[u("div",{class:"cover-background",style:d({backgroundImage:`url(${Te.value.prelude.coverImage})`})},[u("div",B,[u("div",F,[u("h1",G,i(Te.value.prelude.title),1),$e.value?(r(),n("div",S,[a[12]||(a[12]=u("h3",{class:"content-title"},"åºå¹•",-1)),u("div",{class:"content-text",innerHTML:Re($e.value)},null,8,W)])):c("",!0),Te.value.prelude.background?(r(),n("div",X,[a[13]||(a[13]=u("h3",{class:"identity-title"},"ä½ çš„èº«ä»½",-1)),u("p",Y,i(Te.value.prelude.background),1)])):c("",!0),u("div",{class:"prelude-navigation"},[u("button",{class:"btn btn-outline",onClick:Ee}," è¿”å›ž "),u("button",{class:"btn btn-primary",onClick:He}," è¿›å…¥ä½ çš„MLæ•…äº‹ ")])])])],4)])):c("",!0)])):(r(),n("div",q,[u("div",{class:"scene-background",style:d({backgroundImage:`url(${Ce.value})`})},[u("div",{class:p(["scene-overlay",{hidden:ye.value}]),style:d({"--overlay-opacity":ke.value})},[u("div",J,[u("div",{class:"scene-text-wrapper",ref_key:"sceneTextWrapper",ref:fe},[u("div",{class:"scene-text",innerHTML:Re($e.value)},null,8,K)],512)])],6)],4)])),me.value?(r(),n("div",N,[u("div",O,[u("div",Q,[u("h1",Z,i((null==(l=Te.value)?void 0:l.title)||"éº»è¾£å››æ ¼"),1),u("div",ee,i(Be(Ie.value)),1)])]),u("div",ae,[u("div",le,[u("div",{class:"progress-fill",style:d({width:Ie.value/4*100+"%"})},null,4)]),u("div",se,i(Ie.value+1)+" / 5",1)]),u("div",te,[u("button",{class:"settings-btn",onClick:y(je,["stop"])},"âš™ï¸"),ge.value?(r(),n("div",ne,[u("div",re,[a[14]||(a[14]=u("label",null,"æ–‡å­—å¤§å°",-1)),m(u("input",{type:"range",min:"0.8",max:"1.5",step:"0.1","onUpdate:modelValue":a[0]||(a[0]=e=>he.value=e),onInput:De},null,544),[[g,he.value]])]),u("div",ue,[a[16]||(a[16]=u("label",null,"æ–‡å­—é¢œè‰²",-1)),m(u("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>be.value=e),onChange:Pe},[...a[15]||(a[15]=[u("option",{value:"white"},"ç™½è‰²",-1),u("option",{value:"black"},"é»‘è‰²",-1),u("option",{value:"yellow"},"é»„è‰²",-1),u("option",{value:"cyan"},"é’è‰²",-1)])],544),[[h,be.value]])]),u("div",ie,[a[17]||(a[17]=u("label",null,"é®ç½©é€æ˜Žåº¦",-1)),m(u("input",{type:"range",min:"0.3",max:"1.0",step:"0.1","onUpdate:modelValue":a[2]||(a[2]=e=>ke.value=e),onInput:ze},null,544),[[g,ke.value]]),u("span",ce,i(Math.round(100*ke.value))+"%",1)]),u("div",ve,[u("button",{onClick:Ue},i(ye.value?"æ˜¾ç¤ºæ–‡å­—":"éšè—æ–‡å­—"),1)]),u("div",{class:"setting-item"},[u("button",{onClick:_e,class:"back-home-btn"}," â† è¿”å›žä¸»é¡µ ")])])):c("",!0)])])):c("",!0)])):(r(),n("div",_,[u("div",{class:"empty-content"},[a[6]||(a[6]=u("div",{class:"empty-icon"},"ðŸ“š",-1)),a[7]||(a[7]=u("h2",{class:"empty-title"},"æš‚æ— ä¸»é¢˜",-1)),a[8]||(a[8]=u("p",{class:"empty-message"},"è¯·å…ˆé€‰æ‹©ä¸€ä¸ªä¸»é¢˜å¼€å§‹é˜…è¯»",-1)),u("button",{class:"btn btn-primary",onClick:_e},"è¿”å›žé¦–é¡µ")])]))])}}}),[["__scopeId","data-v-cf89d289"]]),de=e({__name:"Reader",setup:e=>(e,a)=>(r(),f(oe))});export{de as default};
