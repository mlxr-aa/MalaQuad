const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-K7kv13GH.js","assets/vendor-DXzVRmrf.js","assets/index-C2q1-25K.css"])))=>i.map(i=>d[i]);
import{u as e,a,b as l,_ as t}from"./index-K7kv13GH.js";import{a as s,r as u,c as i,f as n,b as v,e as r,t as o,n as c,g as d,p,s as m,y as g,F as E,z as h,m as y,o as S}from"./vendor-DXzVRmrf.js";const b={class:"step-editor-page"},_={class:"page-header"},C={class:"editor-content"},I={class:"step-info"},f={class:"step-status"},k={class:"step-content"},N={key:0,class:"title-input-section"},D={key:1,class:"prelude-extra-section"},w={class:"input-group"},x={class:"input-group"},O={class:"input-group"},T={key:2,class:"chapter-input-section"},U=["placeholder"],P={class:"image-upload-section"},$={key:0,class:"upload-placeholder"},R={key:1,class:"image-preview"},A=["src","alt"],L={class:"text-input-section"},G=["placeholder"],V={class:"step-navigation"},j=["disabled"],F=["disabled"],J={class:"overall-progress"},Y={class:"progress-steps"},z={class:"step-number"},B={class:"step-name"},M={class:"step-indicators"},W={class:"actions"},q=["disabled"],H=t(s({__name:"StepEditor",setup(t){const s=y(),H=e(),K=a(),Q=u(0),X=["åºå¹•","ç¬¬ä¸€å¹•","ç¬¬äºŒå¹•","ç¬¬ä¸‰å¹•","å°¾å£°"],Z=u(["","","","",""]),ee=u(["","","","",""]),ae=u(null),le=u(!1),te=u(null),se=u(""),ue=u(""),ie=u(""),ne=u(""),ve=u(["","","",""]),re=(e,a)=>{const l=e.every(e=>""!==e.trim()),t=a.every(e=>""!==e.trim());return l&&t},oe=i(()=>{const e=Z.value.every(e=>""!==e.trim()),a=ee.value.every(e=>""!==e);return e&&a}),ce=e=>{var a;const l=""!==(null==(a=Z.value[e])?void 0:a.trim()),t=""!==ee.value[e];return{hasText:l,hasImage:t,isComplete:l&&t}},de=()=>{Q.value>0&&Q.value--},pe=()=>{Q.value<4&&Q.value++},me=()=>{var e;null==(e=ae.value)||e.click()},ge=e=>{var a;const l=null==(a=e.target.files)?void 0:a[0];if(l){if(!l.type.startsWith("image/"))return void alert("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶");if(l.size>5242880)return void alert("å›¾ç‰‡æ–‡ä»¶ä¸èƒ½è¶…è¿‡5MB");const e=new FileReader;e.onload=e=>{var a;const l=null==(a=e.target)?void 0:a.result;ee.value[Q.value]=l},e.readAsDataURL(l)}},Ee=()=>{ee.value[Q.value]=""},he=()=>{localStorage.setItem("step_editor_draft",JSON.stringify({currentStep:Q.value,stepData:Z.value,stepImages:ee.value,lastSaved:(new Date).toISOString()})),alert("è‰ç¨¿å·²ä¿å­˜")},ye=async()=>{if(!oe.value)return void alert("è¯·å®Œæˆæ‰€æœ‰æ­¥éª¤ï¼ˆåŒ…æ‹¬å›¾ç‰‡å’Œæ–‡æœ¬ï¼‰æ‰èƒ½ä¿å­˜ä¸»é¢˜ï¼");const{SCENE_TYPES:e,SCENE_ORDERS:a}=await l(async()=>{const{SCENE_TYPES:e,SCENE_ORDERS:a}=await import("./index-K7kv13GH.js").then(e=>e.v);return{SCENE_TYPES:e,SCENE_ORDERS:a}},__vite__mapDeps([0,1,2]));if(le.value&&te.value)try{const l=await K.loadTheme(te.value);if(l)if(Array.isArray(l.scenes)){const e={...l,title:se.value||Z.value[0]||"æœªå‘½åä¸»é¢˜",prelude:{...l.prelude,title:se.value||Z.value[0]||"",subtitle:ue.value||"",background:ne.value||"",author:ie.value||l.prelude.author||"",coverImage:ee.value[0]||""},scenes:l.scenes.map((e,a)=>0===a?{...e,title:se.value||Z.value[0]||"",content:Z.value[0]||"",image:ee.value[0]||""}:{...e,title:ve.value[a-1]||e.title,content:Z.value[a]||"",image:ee.value[a]||""}),meta:{...l.meta,updatedAt:(new Date).toISOString(),isDraft:!re(Z.value,ee.value)}};await K.saveTheme(e),alert("ä¸»é¢˜å·²æ›´æ–°")}else{const t={id:l.id,title:se.value||Z.value[0]||"æœªå‘½åä¸»é¢˜",prelude:{title:se.value||Z.value[0]||"",subtitle:ue.value||"",background:ne.value||"",author:ie.value||l.prelude.author||"",coverImage:ee.value[0]||"",tags:l.prelude.tags||[]},scenes:[{id:`${l.id}_prelude`,type:e.PRELUDE,title:se.value||Z.value[0]||"",content:Z.value[0]||"",image:ee.value[0]||"",order:a.PRELUDE},{id:`${l.id}_scene1`,type:e.SCENE,title:ve.value[0]||"ç¬¬ä¸€å¹•",content:Z.value[1]||"",image:ee.value[1]||"",order:a.SCENE1},{id:`${l.id}_scene2`,type:e.SCENE,title:ve.value[1]||"ç¬¬äºŒå¹•",content:Z.value[2]||"",image:ee.value[2]||"",order:a.SCENE2},{id:`${l.id}_scene3`,type:e.SCENE,title:ve.value[2]||"ç¬¬ä¸‰å¹•",content:Z.value[3]||"",image:ee.value[3]||"",order:a.SCENE3},{id:`${l.id}_epilogue`,type:e.EPILOGUE,title:ve.value[3]||"å°¾å£°",content:Z.value[4]||"",image:ee.value[4]||"",order:a.EPILOGUE}],meta:{...l.meta,updatedAt:(new Date).toISOString(),isDraft:!re(Z.value,ee.value)}};await K.saveTheme(t),alert("ä¸»é¢˜å·²æ›´æ–°å¹¶è¿ç§»åˆ°æ–°æ ¼å¼")}}catch(t){alert("æ›´æ–°ä¸»é¢˜å¤±è´¥")}else{const l=`theme_${Date.now()}`,s={id:l,title:se.value||Z.value[0]||"æœªå‘½åä¸»é¢˜",prelude:{title:se.value||Z.value[0]||"",subtitle:ue.value||"",background:ne.value||"",author:ie.value||"",coverImage:ee.value[0]||"",tags:[]},scenes:[{id:`${l}_prelude`,type:e.PRELUDE,title:se.value||Z.value[0]||"",content:Z.value[0]||"",image:ee.value[0]||"",order:a.PRELUDE},{id:`${l}_scene1`,type:e.SCENE,title:ve.value[0]||"ç¬¬ä¸€å¹•",content:Z.value[1]||"",image:ee.value[1]||"",order:a.SCENE1},{id:`${l}_scene2`,type:e.SCENE,title:ve.value[1]||"ç¬¬äºŒå¹•",content:Z.value[2]||"",image:ee.value[2]||"",order:a.SCENE2},{id:`${l}_scene3`,type:e.SCENE,title:ve.value[2]||"ç¬¬ä¸‰å¹•",content:Z.value[3]||"",image:ee.value[3]||"",order:a.SCENE3},{id:`${l}_epilogue`,type:e.EPILOGUE,title:ve.value[3]||"å°¾å£°",content:Z.value[4]||"",image:ee.value[4]||"",order:a.EPILOGUE}],meta:{createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),isDraft:!re(Z.value,ee.value)}};try{await K.saveTheme(s),alert("ä¸»é¢˜å·²ä¿å­˜åˆ°ä¸»é¢˜åˆ—è¡¨")}catch(t){alert("ä¿å­˜ä¸»é¢˜å¤±è´¥")}}localStorage.removeItem("step_editor_draft"),s.push("/")},Se=async()=>{s.push("/")};return n(()=>{(async()=>{const e=H.currentThemeId;if(e)try{const a=await K.loadTheme(e);a&&(le.value=!0,te.value=e,se.value=a.title||a.prelude.title||"",ue.value=a.prelude.subtitle||"",ie.value=a.prelude.author||"",ne.value=a.prelude.background||"",Array.isArray(a.scenes)?(ve.value=a.scenes.slice(1).map(e=>e.title),Z.value=a.scenes.map(e=>e.content),ee.value=a.scenes.map(e=>e.image||"")):(ve.value=a.chapterTitles||["","","",""],Z.value=[a.prelude.title||"",a.scenes.scene1||"",a.scenes.scene2||"",a.scenes.scene3||"",a.scenes.epilogue||""],ee.value=[a.prelude.coverImage||"",a.images[0]||"",a.images[1]||"",a.images[2]||"",a.images[3]||""]))}catch(a){}else le.value=!1,te.value=null})(),(()=>{const e=localStorage.getItem("step_editor_draft");if(e){const a=JSON.parse(e);Q.value=a.currentStep||0,Z.value=a.stepData||["","","","",""],ee.value=a.stepImages||["","","","",""]}})()}),(e,a)=>(S(),v("div",b,[r("div",_,[r("button",{class:"back-btn",onClick:Se},"â† è¿”å›ä¸»é¡µ"),r("h1",null,o(le.value?"ç¼–è¾‘æ•…äº‹":"æ–°å»ºæ•…äº‹"),1)]),r("p",null,o(le.value?"ç¼–è¾‘ç°æœ‰æ•…äº‹çš„å†…å®¹":"åˆ›å»ºæ–°çš„éº»è¾£å››æ ¼æ•…äº‹ï¼ŒæŒ‰æ­¥éª¤å®Œæˆåºå¹•å’Œå››å¹•åˆ›ä½œã€‚"),1),r("div",C,[r("div",I,[r("h2",null,"å½“å‰æ­¥éª¤ï¼š"+o(Q.value+1)+" / "+o(5),1),r("p",null,"æ­¥éª¤åç§°ï¼š"+o(X[Q.value]),1),r("div",f,[r("span",{class:c(["status-item",{completed:ce(Q.value).hasText}])}," ğŸ“ æ–‡æœ¬ï¼š"+o(ce(Q.value).hasText?"å·²å®Œæˆ":"æœªå®Œæˆ"),3),r("span",{class:c(["status-item",{completed:ce(Q.value).hasImage}])}," ğŸ–¼ï¸ å›¾ç‰‡ï¼š"+o(ce(Q.value).hasImage?"å·²å®Œæˆ":"æœªå®Œæˆ"),3)])]),r("div",k,[r("h3",null,o(X[Q.value]),1),0===Q.value?(S(),v("div",N,[a[6]||(a[6]=r("label",{class:"input-label"},"æ•…äº‹æ ‡é¢˜ï¼š",-1)),p(r("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>se.value=e),type:"text",placeholder:"è¯·è¾“å…¥æ•…äº‹æ ‡é¢˜",class:"title-input"},null,512),[[m,se.value]])])):d("",!0),0===Q.value?(S(),v("div",D,[r("div",w,[a[7]||(a[7]=r("label",{class:"input-label"},"ç®€ä»‹ï¼ˆå¯é€‰ï¼‰ï¼š",-1)),p(r("textarea",{"onUpdate:modelValue":a[1]||(a[1]=e=>ue.value=e),placeholder:"è¯·è¾“å…¥ä¸»é¢˜ç®€ä»‹",class:"description-input",rows:"3"},null,512),[[m,ue.value]])]),r("div",x,[a[8]||(a[8]=r("label",{class:"input-label"},"ä½œè€…ï¼š",-1)),p(r("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>ie.value=e),type:"text",placeholder:"è¯·è¾“å…¥ä½œè€…å§“å",class:"author-input"},null,512),[[m,ie.value]])]),r("div",O,[a[9]||(a[9]=r("label",{class:"input-label"},"ç”¨æˆ·èº«ä»½ï¼ˆå¯é€‰ï¼‰ï¼š",-1)),p(r("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>ne.value=e),type:"text",placeholder:"ä¾‹å¦‚ï¼šä½ æ˜¯ä¸€åå­¦ç”Ÿ/åŒ»ç”Ÿ/ä¾¦æ¢ç­‰",class:"identity-input"},null,512),[[m,ne.value]])])])):d("",!0),Q.value>0?(S(),v("div",T,[a[10]||(a[10]=r("label",{class:"input-label"},"ç« èŠ‚åï¼š",-1)),p(r("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>ve.value[Q.value-1]=e),type:"text",placeholder:`è¯·è¾“å…¥${X[Q.value]}çš„ç« èŠ‚å`,class:"chapter-input"},null,8,U),[[m,ve.value[Q.value-1]]])])):d("",!0),r("div",P,[r("div",{class:"upload-area",onClick:me},[ee.value[Q.value]?(S(),v("div",R,[r("img",{src:ee.value[Q.value],alt:`${X[Q.value]}å›¾ç‰‡`},null,8,A),r("button",{class:"remove-image",onClick:g(Ee,["stop"])}," åˆ é™¤ ")])):(S(),v("div",$,[...a[11]||(a[11]=[r("span",{class:"upload-icon"},"ğŸ“·",-1),r("p",null,"ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡",-1),r("small",null,"æ”¯æŒ JPGã€PNGã€GIF æ ¼å¼",-1)])]))]),r("input",{ref_key:"imageInput",ref:ae,type:"file",accept:"image/*",onChange:ge,style:{display:"none"}},null,544)]),r("div",L,[a[12]||(a[12]=r("label",{class:"input-label"},"å†…å®¹æè¿°ï¼š",-1)),p(r("textarea",{"onUpdate:modelValue":a[5]||(a[5]=e=>Z.value[Q.value]=e),placeholder:`è¯·è¾“å…¥${X[Q.value]}çš„å†…å®¹...`,rows:"5"},null,8,G),[[m,Z.value[Q.value]]])]),r("div",V,[r("button",{onClick:de,disabled:0===Q.value}," ä¸Šä¸€æ­¥ ",8,j),r("button",{onClick:pe,disabled:4===Q.value}," ä¸‹ä¸€æ­¥ ",8,F)])])]),r("div",J,[a[13]||(a[13]=r("h3",null,"æ•´ä½“è¿›åº¦",-1)),r("div",Y,[(S(),v(E,null,h(X,(e,a)=>r("div",{key:a,class:c(["progress-step",{completed:ce(a).isComplete,current:a===Q.value}])},[r("span",z,o(a+1),1),r("span",B,o(e),1),r("div",M,[r("span",{class:c(["indicator",{done:ce(a).hasText}])},"ğŸ“",2),r("span",{class:c(["indicator",{done:ce(a).hasImage}])},"ğŸ–¼ï¸",2)])],2)),64))])]),r("div",W,[r("button",{onClick:he},"ä¿å­˜è‰ç¨¿"),r("button",{onClick:ye,disabled:!oe.value,class:c({disabled:!oe.value})},o(le.value?"æ›´æ–°ä¸»é¢˜":"ä¿å­˜ä¸»é¢˜"),11,q),r("button",{onClick:Se},"è¿”å›é¦–é¡µ")])]))}}),[["__scopeId","data-v-64a940dd"]]);export{H as default};
